package fr.utbm.ia54.simulationorca.sarlagent

import io.sarl.core.Initialize
import io.sarl.core.Lifecycle
import fr.utbm.ia54.simulationorca.sarlevent.PerceptionEvent
import io.sarl.core.DefaultContextInteractions
import io.sarl.util.Scopes
import fr.utbm.ia54.simulationorca.sarlcapacity.ComputeNextMoveCapacity
import fr.utbm.ia54.simulationorca.sarlskill.ComputeORCASkill
import fr.utbm.ia54.simulationorca.sarlevent.InfluenceEvent
import fr.utbm.ia54.simulationorca.framework.Vector

agent Pedestrian {

	uses Lifecycle, DefaultContextInteractions,ComputeNextMoveCapacity
	
	var initialPosition : Vector
	var finalPostition : Vector
	
	on Initialize {
		
		initialPosition = occurrence.parameters.get(0) as Vector
		finalPostition = occurrence.parameters.get(1) as Vector

		var skillORCA = new ComputeORCASkill(initialPosition,finalPostition)
		setSkill(ComputeNextMoveCapacity,skillORCA)
	}
	
	on PerceptionEvent{
		println("in PerceptionReceivedEvent")
		
		// Compute next move using ORCA algorithm
		var newPos : Vector = nextMove( occurrence.perceptions)
		
		// Send computed position to the environment
		// selected scope only send the Influence event to the source 
		// of the Perception event, that is to say the Environment
		
		emit(new InfluenceEvent(newPos),Scopes.addresses(occurrence.source))
	}
	
}