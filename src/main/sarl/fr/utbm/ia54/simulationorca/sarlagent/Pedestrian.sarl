package fr.utbm.ia54.simulationorca.sarlagent

import io.sarl.core.Initialize
import io.sarl.core.Lifecycle
import fr.utbm.ia54.simulationorca.framework.Position
import java.util.Collection
import fr.utbm.ia54.simulationorca.sarlevent.PerceptionReceivedEvent
import io.sarl.core.DefaultContextInteractions
import fr.utbm.ia54.simulationorca.sarlevent.InfuenceReceivedEvent
import io.sarl.util.Scopes
import fr.utbm.ia54.simulationorca.sarlcapacity.ComputeNextMoveCapacity
import fr.utbm.ia54.simulationorca.sarlskill.ComputeORCASkill

agent Pedestrian {

	uses Lifecycle, DefaultContextInteractions,ComputeNextMoveCapacity

	
	var initialPosition : Position
	var finalPostition : Position
	
	on Initialize {
		
		initialPosition = (occurrence.parameters.get(0) as Collection<Object>).get(0) as Position
		finalPostition = (occurrence.parameters.get(0) as Collection<Object>).get(0) as Position
		

		var skillORCA = new ComputeORCASkill
		setSkill(ComputeNextMoveCapacity,skillORCA)
	}
	
	on PerceptionReceivedEvent{
		println("in PerceptionReceivedEvent")
		// use skill ComputeORCASkill
		var newPos : Position = nextMove(occurrence.listObstacles,occurrence.bodyPos,occurrence.listNeighbours)
		
		/* 
		 * send his new position with event InfluenceReceivedEvent		
		 * scope send only to the source of PerceptionReceivedEvent, so Environment
		*/
		emit(new InfuenceReceivedEvent(newPos),Scopes.addresses(occurrence.source))

	}	
}